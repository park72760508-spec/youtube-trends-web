<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- CSP 정책 임시 제거 (eval 오류 해결) -->
    
    <title>🎯 시니어 YouTube 트렌드 분석기 Pro | eval 오류 해결</title>
    
    <!-- CSS 파일 -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- 🔧 외부 라이브러리 (eval 호환) -->
    <!-- eval을 사용하지 않는 구버전 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">    
    
    <!-- 메타 태그 -->
    <meta name="description" content="시니어 관련 YouTube 트렌드를 분석하고 엑셀 파일로 다운로드할 수 있는 웹 애플리케이션">
    <meta name="keywords" content="시니어, YouTube, 트렌드, 엑셀, 다운로드, 분석, 노인, 실버">
    
    <!-- PWA 지원 -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="시니어트렌드Pro">
    
    <!-- 파비콘 -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📊</text></svg>">
    
    <!-- 추가 보안 헤더 -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="container">
            <h1>
                <i class="fas fa-chart-trending-up"></i>
                시니어 YouTube 트렌드 분석기 Pro
            </h1>
            <p class="subtitle">🔥 최근 1주일 핫한 영상 검출 | 쇼츠/롱폼 구분 분석 | eval 오류 해결</p>
        </div>
    </header>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <div class="container">
            
            <!-- 검색 및 설정 섹션 -->
            <section class="search-section">
                <div class="search-container">
                    <h2>🔍 고급 트렌드 검색 설정</h2>
                    
                    <div class="search-form">
                        <!-- 첫 번째 행: 기본 설정 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="videoFormat">📺 영상 형식</label>
                                <select id="videoFormat" class="form-control">
                                    <option value="all">🌟 전체 형식</option>
                                    <option value="shorts">📱 쇼츠 (60초 이하)</option>
                                    <option value="long">🎬 롱폼 (60초 초과)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="categorySelect">카테고리 선택</label>
                                <select id="categorySelect" class="form-control">
                                    <option value="all">🌟 전체 카테고리</option>
                                    <option value="health">🏥 건강 & 운동</option>
                                    <option value="hobby">🎨 취미 & 여가</option>
                                    <option value="cooking">🍳 요리 & 레시피</option>
                                    <option value="life">🏠 생활 정보</option>
                                    <option value="travel">✈️ 여행</option>
                                    <option value="tech">📱 시니어 테크</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="timeRange">📅 분석 기간</label>
                                <select id="timeRange" class="form-control">
                                    <option value="week" selected>🔥 최근 1주일 (핫한 영상)</option>
                                    <option value="month">📈 최근 1개월</option>
                                    <option value="3months">📊 최근 3개월</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 두 번째 행: 고급 설정 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sortBy">🎯 분석 기준</label>
                                <select id="sortBy" class="form-control">
                                    <option value="viral_score" selected>🚀 바이럴 점수 (종합)</option>
                                    <option value="growth_rate">📈 성장률 높은 순</option>
                                    <option value="engagement_rate">💬 참여율 높은 순</option>
                                    <option value="views_per_sub">👑 구독자 대비 조회수</option>
                                    <option value="recent_popular">🕐 최신 인기 영상</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="minViews">🎬 최소 조회수</label>
                                <select id="minViews" class="form-control">
                                    <option value="0">제한 없음</option>
                                    <option value="1000">1천 이상</option>
                                    <option value="5000" selected>5천 이상</option>
                                    <option value="10000">1만 이상</option>
                                    <option value="50000">5만 이상</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="videoCount">영상 개수</label>
                                <select id="videoCount" class="form-control">
                                    <option value="20">20개</option>
                                    <option value="50" selected>50개</option>
                                    <option value="100">100개</option>
                                    <option value="200">200개</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 검색 버튼 -->
                        <div class="search-buttons">
                            <button id="searchBtn" class="btn-primary">
                                <i class="fas fa-rocket"></i>
                                🔥 핫한 영상 검출하기
                            </button>
                            
                            <button id="refreshBtn" class="btn-secondary">
                                <i class="fas fa-refresh"></i>
                                새로고침
                            </button>
                        </div>

                        <!-- API 키 불러오기 -->
                        <div class="search-buttons" style="margin-top:12px">
                          <input id="apiKeyFile" type="file" accept=".txt" style="display:none">
                          <button id="loadApiKeyBtn" class="btn-secondary" type="button">
                            <i class="fas fa-key"></i> YouTube API 키 불러오기
                          </button>
                          <button id="clearApiKeyBtn" class="btn-secondary" type="button">
                            <i class="fas fa-eraser"></i> API 키 초기화
                          </button>
                        </div>
                        <p style="text-align:center;color:#64748b;font-size:14px;margin-top:6px">
                          파일 예시: <code>api-key.txt</code> (내용: <code>AIza...</code> 키 문자열 1줄)
                        </p>
                    </div>
                </div>
            </section>

            <!-- 다운로드 섹션 -->
            <section class="download-section" id="downloadSection" style="display: none;">
                <div class="download-container">
                    <h2>📥 데이터 다운로드</h2>
                    <p>분석된 핫한 트렌드 데이터를 다양한 형식으로 다운로드하세요</p>
                    
                    <div class="download-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="downloadVideosCount">0</span>
                            <span class="stat-label">핫한 영상</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="downloadTotalViews">0</span>
                            <span class="stat-label">총 조회수</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="downloadAvgViral">0</span>
                            <span class="stat-label">평균 바이럴 점수</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="downloadShortsRatio">0%</span>
                            <span class="stat-label">쇼츠 비율</span>
                        </div>
                    </div>
                    
                    <div class="download-buttons">
                        <button id="downloadExcel" class="btn-download excel">
                            <i class="fas fa-file-excel"></i>
                            <div>
                                <span class="btn-title">Excel 다운로드</span>
                                <span class="btn-desc">상세 분석 데이터 (.xlsx)</span>
                            </div>
                        </button>
                        
                        <button id="downloadCSV" class="btn-download csv">
                            <i class="fas fa-file-csv"></i>
                            <div>
                                <span class="btn-title">CSV 다운로드</span>
                                <span class="btn-desc">간편 데이터 (.csv)</span>
                            </div>
                        </button>
                        
                        <button id="downloadJSON" class="btn-download json">
                            <i class="fas fa-file-code"></i>
                            <div>
                                <span class="btn-title">JSON 다운로드</span>
                                <span class="btn-desc">개발자용 데이터 (.json)</span>
                            </div>
                        </button>
                        
                        <button id="downloadPDF" class="btn-download pdf">
                            <i class="fas fa-file-pdf"></i>
                            <div>
                                <span class="btn-title">PDF 리포트</span>
                                <span class="btn-desc">분석 보고서 (.pdf)</span>
                            </div>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 통계 대시보드 -->
            <section class="dashboard" id="dashboard" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card trend-up">
                        <i class="fas fa-fire"></i>
                        <div class="stat-content">
                            <h3 id="totalVideos">0</h3>
                            <p>핫한 영상 수</p>
                            <span class="trend-indicator">🔥</span>
                        </div>
                    </div>
                    
                    <div class="stat-card trend-up">
                        <i class="fas fa-mobile-alt"></i>
                        <div class="stat-content">
                            <h3 id="shortsCount">0</h3>
                            <p>쇼츠 영상</p>
                            <span class="trend-indicator">📱</span>
                        </div>
                    </div>
                    
                    <div class="stat-card trend-up">
                        <i class="fas fa-video"></i>
                        <div class="stat-content">
                            <h3 id="longFormCount">0</h3>
                            <p>롱폼 영상</p>
                            <span class="trend-indicator">🎬</span>
                        </div>
                    </div>
                    
                    <div class="stat-card trend-up">
                        <i class="fas fa-rocket"></i>
                        <div class="stat-content">
                            <h3 id="avgViralScore">0</h3>
                            <p>평균 바이럴 점수</p>
                            <span class="trend-indicator">🚀</span>
                        </div>
                    </div>
                    
                    <div class="stat-card trend-up">
                        <i class="fas fa-chart-line"></i>
                        <div class="stat-content">
                            <h3 id="avgGrowthRate">0%</h3>
                            <p>평균 성장률</p>
                            <span class="trend-indicator">📈</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-content">
                            <h3 id="lastUpdate">-</h3>
                            <p>마지막 분석</p>
                            <span class="update-time">방금 전</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 차트 섹션 -->
            <section class="charts-section" id="chartsSection" style="display: none;">
                <div class="chart-row">
                    <div class="chart-container">
                        <h3>📊 쇼츠 vs 롱폼 비율</h3>
                        <canvas id="formatChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>🚀 바이럴 점수 분포</h3>
                        <canvas id="viralChart"></canvas>
                    </div>
                </div>
                <div class="chart-row">
                    <div class="chart-container">
                        <h3>📈 카테고리별 성장률</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>⏰ 시간대별 업로드 트렌드</h3>
                        <canvas id="timeChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- 트렌드 영상 목록 -->
            <section class="video-results" id="videoResults" style="display: none;">
                <div class="results-header">
                    <h3>🔥 핫한 트렌드 영상 분석 결과</h3>
                    <div class="results-controls">
                        <select id="viewMode" class="form-control">
                            <option value="card">카드 보기</option>
                            <option value="table">표 보기</option>
                        </select>
                    </div>
                </div>
                
                <div id="videosList" class="videos-container">
                    <!-- 동적으로 생성될 영상 목록 -->
                </div>
            </section>

            <!-- 로딩 및 에러 상태 -->
            <div id="loadingSpinner" class="loading-container" style="display: none;">
                <div class="loading-spinner">
                    <i class="fas fa-fire fa-spin"></i>
                    <p>🔥 핫한 트렌드 데이터를 분석하고 있습니다...</p>
                    <div class="loading-progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>

            <div id="errorMessage" class="error-container" style="display: none;">
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>분석 중 오류가 발생했습니다</h3>
                    <p>잠시 후 다시 시도해주세요.</p>
                    <button class="btn-secondary" onclick="location.reload()">
                        <i class="fas fa-refresh"></i>
                        페이지 새로고침
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h4>시니어 YouTube 트렌드 분석기 Pro</h4>
                    <p>시니어를 위한 최강의 핫한 영상 검출 도구 (eval 오류 해결)</p>
                </div>
                <div class="footer-features">
                    <h5>Pro 기능</h5>
                    <ul>
                        <li>🔥 실시간 핫한 영상 검출</li>
                        <li>📱 쇼츠/롱폼 구분 분석</li>
                        <li>🚀 바이럴 점수 계산</li>
                        <li>📈 성장률 예측 분석</li>
                        <li>✅ eval 오류 완전 해결</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 시니어 YouTube 트렌드 분석기 Pro. eval 오류 완전 해결!</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript 라이브러리 로딩 확인 -->
    <script>
    console.log('🔍 eval 오류 해결 - 라이브러리 확인 중...');
    
    window.addEventListener('load', function() {
        console.log('📦 라이브러리 로딩 상태:');
        console.log('XLSX:', typeof XLSX !== 'undefined' ? '✅ 로딩됨' : '❌ 실패');
        console.log('Chart:', typeof Chart !== 'undefined' ? '✅ 로딩됨' : '❌ 실패');
        
        if (typeof XLSX !== 'undefined' && typeof Chart !== 'undefined') {
            console.log('🎉 모든 라이브러리 정상 로딩 완료!');
        }
    });
    </script>
    
    <!-- 메인 스크립트 -->
    <script src="script.js"></script>
</body>
</html>
